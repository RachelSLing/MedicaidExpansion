
# Meta --------------------------------------------------------------------

## Title:  American Community Survey Data
## Author: Ian McCarthy
## Date Created: 12/6/2019
## Date Edited:  12/6/2019


# Preliminaries -----------------------------------------------------------
## see list of variable names and tables
acs.lookup(endyear=2012, table.number="B27010", span=1)



# Retrieve ACS data -------------------------------------------------------
states <- geo.make(state="*")
for (t in 2012:2018) {
  ins.all <- acs.fetch(geography=states, table.number="B27010", span=1, endyear=t)
  ins.dat <- ins.all@estimate[,cbind("B27010_018",
                                 "B27010_020",
                                 "B27010_021",
                                 "B27010_022",
                                 "B27010_023",
                                 "B27010_024",
                                 "B27010_025",
                                 "B27010_033",
                                 "B27010_034",
                                 "B27010_036",
                                 "B27010_037",
                                 "B27010_038",
                                 "B27010_039",
                                 "B27010_040",
                                 "B27010_041",
                                 "B27010_050")]
  ins.dat <- as_tibble(ins.dat, 
                       rownames="State")
  ins.dat <- ins.dat %>%
    rename(all_18to34="B27010_018",
           employer_18to34="B27010_020",
           direct_18to34="B27010_021",
           medicare_18to34="B27010_022",
           medicaid_18to34="B27010_023",
           tricare_18to34="B27010_024",
           va_18to34="B27010_025",
           none_18to34="B27010_033",
           all_35to64="B27010_034",
           employer_35to64="B27010_036",
           direct_35to64="B27010_037",
           medicare_35to64="B27010_038",
           medicaid_35to64="B27010_039",
           tricare_35to64="B27010_040",
           va_35to64="B27010_041",
           none_35to64="B27010_050") %>%
    mutate(year=t)
  
  
  assign(paste0('insurance.',t),ins.dat)
}



## More detailed tables/variables

# ins.any <- acs.fetch(geography=states,
#                     variable=c(male_18to24="B27001_009",
#                                male_18to24_ins="B27001_010",
#                                male_18to24_noins="B27001_011",
#                                male_25to34="B27001_012",
#                                male_25to34_ins="B27001_013",
#                                male_25to34_noins="B27001_014",
#                                male_35to44="B27001_015",
#                                male_35to44_ins="B27001_016",
#                                male_35to44_noins="B27001_017",
#                                male_45to54="B27001_018",
#                                male_45to54_ins="B27001_019",
#                                male_45to54_noins="B27001_020",
#                                male_55to64="B27001_021",
#                                male_55to64_ins="B27001_022",
#                                male_55to64_noins="B27001_023",
#                                female_18to24="B27001_037",
#                                female_18to24_ins="B27001_038",
#                                female_18to24_noins="B27001_039",
#                                female_25to34="B27001_040",
#                                female_25to34_ins="B27001_041",
#                                female_25to34_noins="B27001_042",
#                                female_35to44="B27001_043",
#                                female_35to44_ins="B27001_044",
#                                female_35to44_noins="B27001_045",
#                                female_45to54="B27001_046",
#                                female_45to54_ins="B27001_047",
#                                female_45to54_noins="B27001_048",
#                                female_55to64="B27001_049",
#                                female_55to64_ins="B27001_050",
#                                female_55to64_noins="B27001_051"), 
#                     span=1, endyear=2010)
# 
# ins.private <- acs.fetch(geography=states,
#                        variable=c(male_18to24="B27002_009",
#                                   male_18to24_ins="B27002_010",
#                                   male_18to24_noins="B27002_011",
#                                   male_25to34="B27002_012",
#                                   male_25to34_ins="B27002_013",
#                                   male_25to34_noins="B27002_014",
#                                   male_35to44="B27002_015",
#                                   male_35to44_ins="B27002_016",
#                                   male_35to44_noins="B27002_017",
#                                   male_45to54="B27002_018",
#                                   male_45to54_ins="B27002_019",
#                                   male_45to54_noins="B27002_020",
#                                   male_55to64="B27002_021",
#                                   male_55to64_ins="B27002_022",
#                                   male_55to64_noins="B27002_023",
#                                   female_18to24="B27002_037",
#                                   female_18to24_ins="B27002_038",
#                                   female_18to24_noins="B27002_039",
#                                   female_25to34="B27002_040",
#                                   female_25to34_ins="B27002_041",
#                                   female_25to34_noins="B27002_042",
#                                   female_35to44="B27002_043",
#                                   female_35to44_ins="B27002_044",
#                                   female_35to44_noins="B27002_045",
#                                   female_45to54="B27002_046",
#                                   female_45to54_ins="B27002_047",
#                                   female_45to54_noins="B27002_048",
#                                   female_55to64="B27002_049",
#                                   female_55to64_ins="B27002_050",
#                                   female_55to64_noins="B27002_051"), 
#                        span=1, endyear=2010)
# 
# 
# ins.public <- acs.fetch(geography=states,
#                        variable=c(male_18to24="B27003_009",
#                                   male_18to24_ins="B27003_010",
#                                   male_18to24_noins="B27003_011",
#                                   male_25to34="B27003_012",
#                                   male_25to34_ins="B27003_013",
#                                   male_25to34_noins="B27003_014",
#                                   male_35to44="B27003_015",
#                                   male_35to44_ins="B27003_016",
#                                   male_35to44_noins="B27003_017",
#                                   male_45to54="B27003_018",
#                                   male_45to54_ins="B27003_019",
#                                   male_45to54_noins="B27003_020",
#                                   male_55to64="B27003_021",
#                                   male_55to64_ins="B27003_022",
#                                   male_55to64_noins="B27003_023",
#                                   female_18to24="B27003_037",
#                                   female_18to24_ins="B27003_038",
#                                   female_18to24_noins="B27003_039",
#                                   female_25to34="B27003_040",
#                                   female_25to34_ins="B27003_041",
#                                   female_25to34_noins="B27003_042",
#                                   female_35to44="B27003_043",
#                                   female_35to44_ins="B27003_044",
#                                   female_35to44_noins="B27003_045",
#                                   female_45to54="B27003_046",
#                                   female_45to54_ins="B27003_047",
#                                   female_45to54_noins="B27003_048",
#                                   female_55to64="B27003_049",
#                                   female_55to64_ins="B27003_050",
#                                   female_55to64_noins="B27003_051"), 
#                        span=1, endyear=2010)
# 
# 
# ins.employer <- acs.fetch(geography=states,
#                         variable=c(male_18to24="B27004_009",
#                                    male_18to24_ins="B27004_010",
#                                    male_18to24_noins="B27004_011",
#                                    male_25to34="B27004_012",
#                                    male_25to34_ins="B27004_013",
#                                    male_25to34_noins="B27004_014",
#                                    male_35to44="B27004_015",
#                                    male_35to44_ins="B27004_016",
#                                    male_35to44_noins="B27004_017",
#                                    male_45to54="B27004_018",
#                                    male_45to54_ins="B27004_019",
#                                    male_45to54_noins="B27004_020",
#                                    male_55to64="B27004_021",
#                                    male_55to64_ins="B27004_022",
#                                    male_55to64_noins="B27004_023",
#                                    female_18to24="B27004_037",
#                                    female_18to24_ins="B27004_038",
#                                    female_18to24_noins="B27004_039",
#                                    female_25to34="B27004_040",
#                                    female_25to34_ins="B27004_041",
#                                    female_25to34_noins="B27004_042",
#                                    female_35to44="B27004_043",
#                                    female_35to44_ins="B27004_044",
#                                    female_35to44_noins="B27004_045",
#                                    female_45to54="B27004_046",
#                                    female_45to54_ins="B27004_047",
#                                    female_45to54_noins="B27004_048",
#                                    female_55to64="B27004_049",
#                                    female_55to64_ins="B27004_050",
#                                    female_55to64_noins="B27004_051"), 
#                         span=1, endyear=2010)
# 
# ins.direct <- acs.fetch(geography=states,
#                           variable=c(male_18to24="B27005_009",
#                                      male_18to24_ins="B27005_010",
#                                      male_18to24_noins="B27005_011",
#                                      male_25to34="B27005_012",
#                                      male_25to34_ins="B27005_013",
#                                      male_25to34_noins="B27005_014",
#                                      male_35to44="B27005_015",
#                                      male_35to44_ins="B27005_016",
#                                      male_35to44_noins="B27005_017",
#                                      male_45to54="B27005_018",
#                                      male_45to54_ins="B27005_019",
#                                      male_45to54_noins="B27005_020",
#                                      male_55to64="B27005_021",
#                                      male_55to64_ins="B27005_022",
#                                      male_55to64_noins="B27005_023",
#                                      female_18to24="B27005_037",
#                                      female_18to24_ins="B27005_038",
#                                      female_18to24_noins="B27005_039",
#                                      female_25to34="B27005_040",
#                                      female_25to34_ins="B27005_041",
#                                      female_25to34_noins="B27005_042",
#                                      female_35to44="B27005_043",
#                                      female_35to44_ins="B27005_044",
#                                      female_35to44_noins="B27005_045",
#                                      female_45to54="B27005_046",
#                                      female_45to54_ins="B27005_047",
#                                      female_45to54_noins="B27005_048",
#                                      female_55to64="B27005_049",
#                                      female_55to64_ins="B27005_050",
#                                      female_55to64_noins="B27005_051"), 
#                           span=1, endyear=2010)
# 
# 
# ins.medicare <- acs.fetch(geography=states,
#                         variable=c(male_18to24="B27006_009",
#                                    male_18to24_ins="B27006_010",
#                                    male_18to24_noins="B27006_011",
#                                    male_25to34="B27006_012",
#                                    male_25to34_ins="B27006_013",
#                                    male_25to34_noins="B27006_014",
#                                    male_35to44="B27006_015",
#                                    male_35to44_ins="B27006_016",
#                                    male_35to44_noins="B27006_017",
#                                    male_45to54="B27006_018",
#                                    male_45to54_ins="B27006_019",
#                                    male_45to54_noins="B27006_020",
#                                    male_55to64="B27006_021",
#                                    male_55to64_ins="B27006_022",
#                                    male_55to64_noins="B27006_023",
#                                    female_18to24="B27006_037",
#                                    female_18to24_ins="B27006_038",
#                                    female_18to24_noins="B27006_039",
#                                    female_25to34="B27006_040",
#                                    female_25to34_ins="B27006_041",
#                                    female_25to34_noins="B27006_042",
#                                    female_35to44="B27006_043",
#                                    female_35to44_ins="B27006_044",
#                                    female_35to44_noins="B27006_045",
#                                    female_45to54="B27006_046",
#                                    female_45to54_ins="B27006_047",
#                                    female_45to54_noins="B27006_048",
#                                    female_55to64="B27006_049",
#                                    female_55to64_ins="B27006_050",
#                                    female_55to64_noins="B27006_051"), 
#                         span=1, endyear=2010)
# 
# 
# ins.medicaid <- acs.fetch(geography=states,
#                           variable=c(male_18to24="B27007_009",
#                                      male_18to24_ins="B27007_010",
#                                      male_18to24_noins="B27007_011",
#                                      male_25to34="B27007_012",
#                                      male_25to34_ins="B27007_013",
#                                      male_25to34_noins="B27007_014",
#                                      male_35to44="B27007_015",
#                                      male_35to44_ins="B27007_016",
#                                      male_35to44_noins="B27007_017",
#                                      male_45to54="B27007_018",
#                                      male_45to54_ins="B27007_019",
#                                      male_45to54_noins="B27007_020",
#                                      male_55to64="B27007_021",
#                                      male_55to64_ins="B27007_022",
#                                      male_55to64_noins="B27007_023",
#                                      female_18to24="B27007_037",
#                                      female_18to24_ins="B27007_038",
#                                      female_18to24_noins="B27007_039",
#                                      female_25to34="B27007_040",
#                                      female_25to34_ins="B27007_041",
#                                      female_25to34_noins="B27007_042",
#                                      female_35to44="B27007_043",
#                                      female_35to44_ins="B27007_044",
#                                      female_35to44_noins="B27007_045",
#                                      female_45to54="B27007_046",
#                                      female_45to54_ins="B27007_047",
#                                      female_45to54_noins="B27007_048",
#                                      female_55to64="B27007_049",
#                                      female_55to64_ins="B27007_050",
#                                      female_55to64_noins="B27007_051"), 
#                           span=1, endyear=2010)


# Tidy --------------------------------------------------------------------

final.insurance <- rbind(insurance.2012, insurance.2013, insurance.2014, insurance.2015, insurance.2016,
                         insurance.2017, insurance.2018)
final.insurance <- final.insurance %>%
  mutate(adult_pop = all_18to34 + all_35to64,
         ins_employer = employer_18to34 + employer_35to64,
         ins_direct = direct_18to34 + direct_35to64,
         ins_medicare = medicare_18to34 + medicare_35to64,
         ins_medicaid = medicaid_18to34 + medicaid_35to64,
         uninsured = none_18to34 + none_35to64) %>%
  select(State, year, adult_pop, ins_employer, ins_direct, 
         ins_medicare, ins_medicaid, uninsured)
